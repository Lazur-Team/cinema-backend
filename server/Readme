Cinema-Tver Server

The server is responsible for handling API requests, managing the database, and providing GraphQL endpoints.

ğŸš€ Tech Stack

Language: Go

Frameworks & Libraries: GORM, GraphQL

Database: PostgreSQL

ğŸ“‚ Project Structure

server/
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ db/         # Database connection
â”‚   â”œâ”€â”€ migrations/ # Database migrations
â”‚   â”œâ”€â”€ models/     # GORM models
â”‚   â”œâ”€â”€ graphql/    # GraphQL resolvers & schema
â”‚   â””â”€â”€ config/     # Configuration handling
â”œâ”€â”€ server/         # Server logic
â”œâ”€â”€ main.go         # Server entry point
â””â”€â”€ go.mod          # Dependencies

ğŸ› ï¸ Setup & Running

1ï¸âƒ£ Configure Environment Variables

Ensure .env contains the correct values:

SERVER_PORT=8080

DB_USER=cinema-tver
DB_PASS=cinema-tver
DB_NAME=cinema-tver
DB_HOST=db
DB_PORT=5432
DATABASE_URL=postgres://$(DB_USER):$(DB_PASS)@$(DB_HOST):$(DB_PORT)/$(DB_NAME)?sslmode=disable

2ï¸âƒ£ Run the Server

Run this command from the root directory:

make run-server

3ï¸âƒ£ Run Migrations

make migrate-up

ğŸ” Working with GORM

The server uses GORM for database interactions. Example model:

type Movie struct {
    ID          uuid.UUID `gorm:"type:uuid;default:gen_random_uuid();primaryKey"`
    Title       string    `gorm:"not null"`
    Description *string
    ReleaseYear int
    CreatedAt   time.Time      `gorm:"autoCreateTime"`
    UpdatedAt   time.Time      `gorm:"autoUpdateTime"`
    DeletedAt   gorm.DeletedAt `gorm:"index"`
}

Performing CRUD Operations

// Create a new movie
db.Create(&Movie{Title: "Inception", ReleaseYear: 2010})

// Find a movie by ID
var movie Movie
db.First(&movie, "id = ?", someID)

// Update a movie
db.Model(&movie).Update("Title", "Interstellar")

// Delete a movie
db.Delete(&movie)

ğŸ” GraphQL API

The project exposes a GraphQL API for querying movie data. Example:

Query

query {
  movies {
    id
    title
    releaseYear
  }
}

Mutation

mutation {
  addMovie(input: {title: "The Matrix", releaseYear: 1999}) {
    id
    title
  }
}

GraphQL endpoint:

http://localhost:8080/graphql

ğŸ”§ Useful Commands

make run-server      # Start the server
make migrate-up      # Apply database migrations
make migrate-down    # Rollback last migration
make migrate-create name=create_movies_table  # Create a new migration file

ğŸ› ï¸ Development Notes

Inside container: The server connects to db:5432.

Ports mapping: PostgreSQL inside Docker uses 5432, but it's exposed as 5433 locally.

ğŸ¤ Contributing

Feel free to open issues or submit pull requests to improve the server.

ğŸ“œ License

This project is licensed under the MIT License.

